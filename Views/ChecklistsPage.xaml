<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:powered_parachute.ViewModels"
             xmlns:m="clr-namespace:UraniumUI.Icons.MaterialIcons;assembly=UraniumUI.Icons.MaterialIcons"
             x:Class="powered_parachute.Views.ChecklistsPage"
             x:DataType="vm:ChecklistsViewModel"
             Title="{Binding Title}">

    <Grid RowDefinitions="Auto,*">

        <!-- Header with Edit Toggle -->
        <Border Grid.Row="0"
                BackgroundColor="{StaticResource Primary}"
                Padding="22,20"
                StrokeThickness="0">
            <Grid ColumnDefinitions="*,Auto">
                <Label Grid.Column="0"
                       Text="Select a checklist to begin"
                       FontSize="20"
                       FontAttributes="Bold"
                       TextColor="White"
                       VerticalOptions="Center" />

                <Button Grid.Column="1"
                        Text="{Binding IsEditMode, Converter={StaticResource InvertedBoolConverter}, StringFormat='{0}'}"
                        Command="{Binding ToggleEditModeCommand}"
                        BackgroundColor="Transparent"
                        TextColor="White"
                        FontSize="16"
                        FontAttributes="Bold"
                        VerticalOptions="Center">
                    <Button.Triggers>
                        <DataTrigger TargetType="Button" Binding="{Binding IsEditMode}" Value="False">
                            <Setter Property="Text" Value="Edit" />
                        </DataTrigger>
                        <DataTrigger TargetType="Button" Binding="{Binding IsEditMode}" Value="True">
                            <Setter Property="Text" Value="Done" />
                        </DataTrigger>
                    </Button.Triggers>
                </Button>
            </Grid>
        </Border>

        <!-- Checklists List -->
        <ScrollView Grid.Row="1" BackgroundColor="#F5F5F5">
            <VerticalStackLayout Padding="22" Spacing="18">

                <VerticalStackLayout Spacing="0" BindableLayout.ItemsSource="{Binding Checklists}">
                    <BindableLayout.ItemTemplate>
                        <DataTemplate x:DataType="vm:ChecklistInfo">
                            <Border StrokeThickness="2"
                                    Stroke="{StaticResource Gray300}"
                                    BackgroundColor="White"
                                    Padding="0"
                                    Margin="0,0,0,18"
                                    MinimumHeightRequest="90">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="14" />
                                </Border.StrokeShape>
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:ChecklistsViewModel}}, Path=OpenChecklistCommand}"
                                                          CommandParameter="{Binding .}" />
                                </Border.GestureRecognizers>

                                <Grid ColumnDefinitions="*,Auto,Auto,Auto" Padding="24,16">
                                    <!-- Name and Description -->
                                    <VerticalStackLayout Grid.Column="0" VerticalOptions="Center" Spacing="4">
                                        <Label Text="{Binding DisplayName}"
                                               FontSize="22"
                                               FontAttributes="Bold"
                                               TextColor="{StaticResource Primary}" />
                                        <Label Text="{Binding Description}"
                                               FontSize="14"
                                               TextColor="{StaticResource Gray500}"
                                               IsVisible="{Binding Description, Converter={StaticResource StringNullOrEmptyBoolConverter}}" />
                                    </VerticalStackLayout>

                                    <!-- Edit Button (visible in edit mode) -->
                                    <Button Grid.Column="1"
                                            Text="Edit"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type vm:ChecklistsViewModel}}, Path=EditChecklistCommand}"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="{StaticResource Primary}"
                                            TextColor="White"
                                            FontSize="14"
                                            HeightRequest="36"
                                            Padding="12,0"
                                            CornerRadius="8"
                                            VerticalOptions="Center"
                                            Margin="8,0"
                                            IsVisible="{Binding Source={RelativeSource AncestorType={x:Type vm:ChecklistsViewModel}}, Path=IsEditMode}" />

                                    <!-- Delete Button (visible in edit mode, not for defaults) -->
                                    <Button Grid.Column="2"
                                            Text="Delete"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type vm:ChecklistsViewModel}}, Path=DeleteChecklistCommand}"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="{StaticResource Secondary}"
                                            TextColor="White"
                                            FontSize="14"
                                            HeightRequest="36"
                                            Padding="12,0"
                                            CornerRadius="8"
                                            VerticalOptions="Center"
                                            IsVisible="{Binding Source={RelativeSource AncestorType={x:Type vm:ChecklistsViewModel}}, Path=IsEditMode}" />

                                    <!-- Chevron (visible in normal mode) -->
                                    <Label Grid.Column="3"
                                           FontFamily="MaterialRegular"
                                           FontSize="32"
                                           Text="{x:Static m:MaterialRegular.Chevron_right}"
                                           TextColor="{StaticResource Gray400}"
                                           VerticalOptions="Center" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </BindableLayout.ItemTemplate>
                </VerticalStackLayout>

                <!-- Add Checklist Button (visible in edit mode) -->
                <Button Text="+ Add Checklist"
                        Command="{Binding AddChecklistCommand}"
                        BackgroundColor="{StaticResource Success}"
                        TextColor="White"
                        FontSize="18"
                        FontAttributes="Bold"
                        HeightRequest="55"
                        CornerRadius="12"
                        IsVisible="{Binding IsEditMode}" />

            </VerticalStackLayout>
        </ScrollView>

    </Grid>
</ContentPage>
